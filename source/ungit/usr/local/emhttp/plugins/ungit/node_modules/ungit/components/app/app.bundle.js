(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){

var ko = require('knockout');
var components = require('ungit-components');
var programEvents = require('ungit-program-events');
var navigation = require('ungit-navigation');

components.register('app', function(args) {
  return new AppViewModel(args.appContainer, args.server);
});

var AppViewModel = function(appContainer, server) {
  var self = this;
  this.appContainer = appContainer;
  this.server = server;
  if (window.location.search.indexOf('noheader=true') < 0)
    this.header = components.create('header', { app: this });
  this.dialog = ko.observable(null);

  this.repoList = ko.observableArray(JSON.parse(localStorage.getItem('repositories') || localStorage.getItem('visitedRepositories') || '[]')); // visitedRepositories is legacy, remove in the next version
  this.repoList.subscribe(function(newValue) { localStorage.setItem('repositories', JSON.stringify(newValue)); });

  this.content = ko.observable(components.create('home', { app: this }));
  this.currentVersion = ko.observable();
  this.latestVersion = ko.observable();
  this.newVersionAvailable = ko.observable();
  this.newVersionInstallCommand = (ungit.platform == 'win32' ? '' : 'sudo -H ') + 'npm update -g ungit';
  this.bugtrackingEnabled = ko.observable(ungit.config.bugtracking);

  this.bugtrackingNagscreenDismissed = ko.observable(localStorage.getItem('bugtrackingNagscreenDismissed'));
  this.showBugtrackingNagscreen = ko.computed(function() {
    return !self.bugtrackingEnabled() && !self.bugtrackingNagscreenDismissed();
  });

  this.gitVersionErrorDismissed = ko.observable(localStorage.getItem('gitVersionErrorDismissed'));
  this.gitVersionError = ko.observable();
  this.gitVersionErrorVisible = ko.computed(function() {
    return !ungit.config.gitVersionCheckOverride && self.gitVersionError() && !self.gitVersionErrorDismissed();
  });

  var NPSSurveyLastDismissed = parseInt(localStorage.getItem('NPSSurveyLastDismissed') || '0');
  var monthsSinceNPSLastDismissed = (Date.now() - NPSSurveyLastDismissed) / (1000 * 60 * 60 * 24 * 30);
  this.showNPSSurvey = ko.observable(monthsSinceNPSLastDismissed >= 6 && Math.random() < 0.01);
  this.sendNPS = function(value) {
    keen.addEvent('survey-nps', {
      version: ungit.version,
      userHash: ungit.userHash,
      rating: value,
      bugtrackingEnabled: ungit.config.bugtracking,
      sendUsageStatistics: ungit.config.sendUsageStatistics
    });
    self.dismissNPSSurvey();
  }

}

AppViewModel.prototype.updateNode = function(parentElement) {
  ko.renderTemplate('app', this, {}, parentElement);
}
AppViewModel.prototype.template = 'app';
AppViewModel.prototype.shown = function() {
  var self = this;
  // The ungit.config variable collections configuration from all different paths and only updates when
  // ungit is restarted
  if(!ungit.config.bugtracking) {
    // Whereas the userconfig only reflects what's in the ~/.ungitrc and updates directly,
    // but is only used for changing around the configuration. We need to check this here
    // since ungit may have crashed without the server crashing since we enabled bugtracking,
    // and we don't want to show the nagscreen twice in that case.
    this.server.get('/userconfig', undefined, function(err, userConfig) {
      self.bugtrackingEnabled(userConfig.bugtracking);
    });
  }

  this.server.get('/latestversion', undefined, function(err, version) {
    if (!version) return;
    self.currentVersion(version.currentVersion);
    self.latestVersion(version.latestVersion);
    self.newVersionAvailable(version.outdated);
  });
  this.server.get('/gitversion', undefined, function(err, gitversion) {
    if (!gitversion) return;
    if (!gitversion.satisfied) {
      self.gitVersionError(gitversion.error);
    }
  });
}
AppViewModel.prototype.updateAnimationFrame = function(deltaT) {
  if (this.content() && this.content().updateAnimationFrame) this.content().updateAnimationFrame(deltaT);
}
AppViewModel.prototype.onProgramEvent = function(event) {
  if (event.event == 'request-credentials') this._handleCredentialsRequested(event);
  else if (event.event == 'request-show-dialog') this.showDialog(event.dialog);
  else if (event.event == 'request-remember-repo') this._handleRequestRememberRepo(event);

  if (this.content() && this.content().onProgramEvent)
    this.content().onProgramEvent(event);
  if (this.header && this.header.onProgramEvent) this.header.onProgramEvent(event);
}
AppViewModel.prototype._handleRequestRememberRepo = function(event) {
  var repoPath = event.repoPath;
  if (this.repoList.indexOf(repoPath) != -1) return;
  this.repoList.push(repoPath);
}
AppViewModel.prototype._handleCredentialsRequested = function() {
  var self = this;
  var diag;
  // Only show one credentials dialog if we're asked to show another one while the first one is open
  // This happens for instance when we fetch nodes and remote tags at the same time
  if (this._isShowingCredentialsDialog)
    diag = self.dialog();
  else {
    diag = components.create('credentialsdialog');
    self.showDialog(diag);
  }
  this._isShowingCredentialsDialog = true;
  diag.closed.add(function() {
    self._isShowingCredentialsDialog = false;
    programEvents.dispatch({ event: 'request-credentials-response', username: diag.username(), password: diag.password() });
  });
}
AppViewModel.prototype.showDialog = function(dialog) {
  var self = this;
  dialog.closed.add(function() {
    self.dialog(null);
  })
  this.dialog(dialog);
}
AppViewModel.prototype.enableBugtrackingAndStatistics = function() {
  var self = this;
  this.server.get('/userconfig', undefined, function(err, userConfig) {
    if (err) return;
    userConfig.bugtracking = true;
    userConfig.sendUsageStatistics = true;
    self.server.post('/userconfig', userConfig, function(err) {
      if (err) return;
      self.bugtrackingEnabled(true);
    });
  });
}
AppViewModel.prototype.enableBugtracking = function() {
  var self = this;
  this.server.get('/userconfig', undefined, function(err, userConfig) {
    if (err) return;
    userConfig.bugtracking = true;
    self.server.post('/userconfig', userConfig, function(err) {
      if (err) return;
      self.bugtrackingEnabled(true);
    });
  });
}
AppViewModel.prototype.dismissBugtrackingNagscreen = function() {
  localStorage.setItem('bugtrackingNagscreenDismissed', true);
  this.bugtrackingNagscreenDismissed(true);
}
AppViewModel.prototype.dismissGitVersionError = function() {
  localStorage.setItem('gitVersionErrorDismissed', true);
  this.gitVersionErrorDismissed(true);
}
AppViewModel.prototype.dismissNPSSurvey = function() {
  this.showNPSSurvey(false);
  localStorage.setItem('NPSSurveyLastDismissed', Date.now());
}
AppViewModel.prototype.templateChooser = function(data) {
  if (!data) return '';
  return data.template;
};

},{"knockout":"knockout","ungit-components":"ungit-components","ungit-navigation":"ungit-navigation","ungit-program-events":"ungit-program-events"}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJjb21wb25lbnRzL2FwcC9hcHAuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUNBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIik7dGhyb3cgZi5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsIlxudmFyIGtvID0gcmVxdWlyZSgna25vY2tvdXQnKTtcbnZhciBjb21wb25lbnRzID0gcmVxdWlyZSgndW5naXQtY29tcG9uZW50cycpO1xudmFyIHByb2dyYW1FdmVudHMgPSByZXF1aXJlKCd1bmdpdC1wcm9ncmFtLWV2ZW50cycpO1xudmFyIG5hdmlnYXRpb24gPSByZXF1aXJlKCd1bmdpdC1uYXZpZ2F0aW9uJyk7XG5cbmNvbXBvbmVudHMucmVnaXN0ZXIoJ2FwcCcsIGZ1bmN0aW9uKGFyZ3MpIHtcbiAgcmV0dXJuIG5ldyBBcHBWaWV3TW9kZWwoYXJncy5hcHBDb250YWluZXIsIGFyZ3Muc2VydmVyKTtcbn0pO1xuXG52YXIgQXBwVmlld01vZGVsID0gZnVuY3Rpb24oYXBwQ29udGFpbmVyLCBzZXJ2ZXIpIHtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICB0aGlzLmFwcENvbnRhaW5lciA9IGFwcENvbnRhaW5lcjtcbiAgdGhpcy5zZXJ2ZXIgPSBzZXJ2ZXI7XG4gIGlmICh3aW5kb3cubG9jYXRpb24uc2VhcmNoLmluZGV4T2YoJ25vaGVhZGVyPXRydWUnKSA8IDApXG4gICAgdGhpcy5oZWFkZXIgPSBjb21wb25lbnRzLmNyZWF0ZSgnaGVhZGVyJywgeyBhcHA6IHRoaXMgfSk7XG4gIHRoaXMuZGlhbG9nID0ga28ub2JzZXJ2YWJsZShudWxsKTtcblxuICB0aGlzLnJlcG9MaXN0ID0ga28ub2JzZXJ2YWJsZUFycmF5KEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3JlcG9zaXRvcmllcycpIHx8IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCd2aXNpdGVkUmVwb3NpdG9yaWVzJykgfHwgJ1tdJykpOyAvLyB2aXNpdGVkUmVwb3NpdG9yaWVzIGlzIGxlZ2FjeSwgcmVtb3ZlIGluIHRoZSBuZXh0IHZlcnNpb25cbiAgdGhpcy5yZXBvTGlzdC5zdWJzY3JpYmUoZnVuY3Rpb24obmV3VmFsdWUpIHsgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ3JlcG9zaXRvcmllcycsIEpTT04uc3RyaW5naWZ5KG5ld1ZhbHVlKSk7IH0pO1xuXG4gIHRoaXMuY29udGVudCA9IGtvLm9ic2VydmFibGUoY29tcG9uZW50cy5jcmVhdGUoJ2hvbWUnLCB7IGFwcDogdGhpcyB9KSk7XG4gIHRoaXMuY3VycmVudFZlcnNpb24gPSBrby5vYnNlcnZhYmxlKCk7XG4gIHRoaXMubGF0ZXN0VmVyc2lvbiA9IGtvLm9ic2VydmFibGUoKTtcbiAgdGhpcy5uZXdWZXJzaW9uQXZhaWxhYmxlID0ga28ub2JzZXJ2YWJsZSgpO1xuICB0aGlzLm5ld1ZlcnNpb25JbnN0YWxsQ29tbWFuZCA9ICh1bmdpdC5wbGF0Zm9ybSA9PSAnd2luMzInID8gJycgOiAnc3VkbyAtSCAnKSArICducG0gdXBkYXRlIC1nIHVuZ2l0JztcbiAgdGhpcy5idWd0cmFja2luZ0VuYWJsZWQgPSBrby5vYnNlcnZhYmxlKHVuZ2l0LmNvbmZpZy5idWd0cmFja2luZyk7XG5cbiAgdGhpcy5idWd0cmFja2luZ05hZ3NjcmVlbkRpc21pc3NlZCA9IGtvLm9ic2VydmFibGUobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2J1Z3RyYWNraW5nTmFnc2NyZWVuRGlzbWlzc2VkJykpO1xuICB0aGlzLnNob3dCdWd0cmFja2luZ05hZ3NjcmVlbiA9IGtvLmNvbXB1dGVkKGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiAhc2VsZi5idWd0cmFja2luZ0VuYWJsZWQoKSAmJiAhc2VsZi5idWd0cmFja2luZ05hZ3NjcmVlbkRpc21pc3NlZCgpO1xuICB9KTtcblxuICB0aGlzLmdpdFZlcnNpb25FcnJvckRpc21pc3NlZCA9IGtvLm9ic2VydmFibGUobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2dpdFZlcnNpb25FcnJvckRpc21pc3NlZCcpKTtcbiAgdGhpcy5naXRWZXJzaW9uRXJyb3IgPSBrby5vYnNlcnZhYmxlKCk7XG4gIHRoaXMuZ2l0VmVyc2lvbkVycm9yVmlzaWJsZSA9IGtvLmNvbXB1dGVkKGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiAhdW5naXQuY29uZmlnLmdpdFZlcnNpb25DaGVja092ZXJyaWRlICYmIHNlbGYuZ2l0VmVyc2lvbkVycm9yKCkgJiYgIXNlbGYuZ2l0VmVyc2lvbkVycm9yRGlzbWlzc2VkKCk7XG4gIH0pO1xuXG4gIHZhciBOUFNTdXJ2ZXlMYXN0RGlzbWlzc2VkID0gcGFyc2VJbnQobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ05QU1N1cnZleUxhc3REaXNtaXNzZWQnKSB8fCAnMCcpO1xuICB2YXIgbW9udGhzU2luY2VOUFNMYXN0RGlzbWlzc2VkID0gKERhdGUubm93KCkgLSBOUFNTdXJ2ZXlMYXN0RGlzbWlzc2VkKSAvICgxMDAwICogNjAgKiA2MCAqIDI0ICogMzApO1xuICB0aGlzLnNob3dOUFNTdXJ2ZXkgPSBrby5vYnNlcnZhYmxlKG1vbnRoc1NpbmNlTlBTTGFzdERpc21pc3NlZCA+PSA2ICYmIE1hdGgucmFuZG9tKCkgPCAwLjAxKTtcbiAgdGhpcy5zZW5kTlBTID0gZnVuY3Rpb24odmFsdWUpIHtcbiAgICBrZWVuLmFkZEV2ZW50KCdzdXJ2ZXktbnBzJywge1xuICAgICAgdmVyc2lvbjogdW5naXQudmVyc2lvbixcbiAgICAgIHVzZXJIYXNoOiB1bmdpdC51c2VySGFzaCxcbiAgICAgIHJhdGluZzogdmFsdWUsXG4gICAgICBidWd0cmFja2luZ0VuYWJsZWQ6IHVuZ2l0LmNvbmZpZy5idWd0cmFja2luZyxcbiAgICAgIHNlbmRVc2FnZVN0YXRpc3RpY3M6IHVuZ2l0LmNvbmZpZy5zZW5kVXNhZ2VTdGF0aXN0aWNzXG4gICAgfSk7XG4gICAgc2VsZi5kaXNtaXNzTlBTU3VydmV5KCk7XG4gIH1cblxufVxuXG5BcHBWaWV3TW9kZWwucHJvdG90eXBlLnVwZGF0ZU5vZGUgPSBmdW5jdGlvbihwYXJlbnRFbGVtZW50KSB7XG4gIGtvLnJlbmRlclRlbXBsYXRlKCdhcHAnLCB0aGlzLCB7fSwgcGFyZW50RWxlbWVudCk7XG59XG5BcHBWaWV3TW9kZWwucHJvdG90eXBlLnRlbXBsYXRlID0gJ2FwcCc7XG5BcHBWaWV3TW9kZWwucHJvdG90eXBlLnNob3duID0gZnVuY3Rpb24oKSB7XG4gIHZhciBzZWxmID0gdGhpcztcbiAgLy8gVGhlIHVuZ2l0LmNvbmZpZyB2YXJpYWJsZSBjb2xsZWN0aW9ucyBjb25maWd1cmF0aW9uIGZyb20gYWxsIGRpZmZlcmVudCBwYXRocyBhbmQgb25seSB1cGRhdGVzIHdoZW5cbiAgLy8gdW5naXQgaXMgcmVzdGFydGVkXG4gIGlmKCF1bmdpdC5jb25maWcuYnVndHJhY2tpbmcpIHtcbiAgICAvLyBXaGVyZWFzIHRoZSB1c2VyY29uZmlnIG9ubHkgcmVmbGVjdHMgd2hhdCdzIGluIHRoZSB+Ly51bmdpdHJjIGFuZCB1cGRhdGVzIGRpcmVjdGx5LFxuICAgIC8vIGJ1dCBpcyBvbmx5IHVzZWQgZm9yIGNoYW5naW5nIGFyb3VuZCB0aGUgY29uZmlndXJhdGlvbi4gV2UgbmVlZCB0byBjaGVjayB0aGlzIGhlcmVcbiAgICAvLyBzaW5jZSB1bmdpdCBtYXkgaGF2ZSBjcmFzaGVkIHdpdGhvdXQgdGhlIHNlcnZlciBjcmFzaGluZyBzaW5jZSB3ZSBlbmFibGVkIGJ1Z3RyYWNraW5nLFxuICAgIC8vIGFuZCB3ZSBkb24ndCB3YW50IHRvIHNob3cgdGhlIG5hZ3NjcmVlbiB0d2ljZSBpbiB0aGF0IGNhc2UuXG4gICAgdGhpcy5zZXJ2ZXIuZ2V0KCcvdXNlcmNvbmZpZycsIHVuZGVmaW5lZCwgZnVuY3Rpb24oZXJyLCB1c2VyQ29uZmlnKSB7XG4gICAgICBzZWxmLmJ1Z3RyYWNraW5nRW5hYmxlZCh1c2VyQ29uZmlnLmJ1Z3RyYWNraW5nKTtcbiAgICB9KTtcbiAgfVxuXG4gIHRoaXMuc2VydmVyLmdldCgnL2xhdGVzdHZlcnNpb24nLCB1bmRlZmluZWQsIGZ1bmN0aW9uKGVyciwgdmVyc2lvbikge1xuICAgIGlmICghdmVyc2lvbikgcmV0dXJuO1xuICAgIHNlbGYuY3VycmVudFZlcnNpb24odmVyc2lvbi5jdXJyZW50VmVyc2lvbik7XG4gICAgc2VsZi5sYXRlc3RWZXJzaW9uKHZlcnNpb24ubGF0ZXN0VmVyc2lvbik7XG4gICAgc2VsZi5uZXdWZXJzaW9uQXZhaWxhYmxlKHZlcnNpb24ub3V0ZGF0ZWQpO1xuICB9KTtcbiAgdGhpcy5zZXJ2ZXIuZ2V0KCcvZ2l0dmVyc2lvbicsIHVuZGVmaW5lZCwgZnVuY3Rpb24oZXJyLCBnaXR2ZXJzaW9uKSB7XG4gICAgaWYgKCFnaXR2ZXJzaW9uKSByZXR1cm47XG4gICAgaWYgKCFnaXR2ZXJzaW9uLnNhdGlzZmllZCkge1xuICAgICAgc2VsZi5naXRWZXJzaW9uRXJyb3IoZ2l0dmVyc2lvbi5lcnJvcik7XG4gICAgfVxuICB9KTtcbn1cbkFwcFZpZXdNb2RlbC5wcm90b3R5cGUudXBkYXRlQW5pbWF0aW9uRnJhbWUgPSBmdW5jdGlvbihkZWx0YVQpIHtcbiAgaWYgKHRoaXMuY29udGVudCgpICYmIHRoaXMuY29udGVudCgpLnVwZGF0ZUFuaW1hdGlvbkZyYW1lKSB0aGlzLmNvbnRlbnQoKS51cGRhdGVBbmltYXRpb25GcmFtZShkZWx0YVQpO1xufVxuQXBwVmlld01vZGVsLnByb3RvdHlwZS5vblByb2dyYW1FdmVudCA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gIGlmIChldmVudC5ldmVudCA9PSAncmVxdWVzdC1jcmVkZW50aWFscycpIHRoaXMuX2hhbmRsZUNyZWRlbnRpYWxzUmVxdWVzdGVkKGV2ZW50KTtcbiAgZWxzZSBpZiAoZXZlbnQuZXZlbnQgPT0gJ3JlcXVlc3Qtc2hvdy1kaWFsb2cnKSB0aGlzLnNob3dEaWFsb2coZXZlbnQuZGlhbG9nKTtcbiAgZWxzZSBpZiAoZXZlbnQuZXZlbnQgPT0gJ3JlcXVlc3QtcmVtZW1iZXItcmVwbycpIHRoaXMuX2hhbmRsZVJlcXVlc3RSZW1lbWJlclJlcG8oZXZlbnQpO1xuXG4gIGlmICh0aGlzLmNvbnRlbnQoKSAmJiB0aGlzLmNvbnRlbnQoKS5vblByb2dyYW1FdmVudClcbiAgICB0aGlzLmNvbnRlbnQoKS5vblByb2dyYW1FdmVudChldmVudCk7XG4gIGlmICh0aGlzLmhlYWRlciAmJiB0aGlzLmhlYWRlci5vblByb2dyYW1FdmVudCkgdGhpcy5oZWFkZXIub25Qcm9ncmFtRXZlbnQoZXZlbnQpO1xufVxuQXBwVmlld01vZGVsLnByb3RvdHlwZS5faGFuZGxlUmVxdWVzdFJlbWVtYmVyUmVwbyA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gIHZhciByZXBvUGF0aCA9IGV2ZW50LnJlcG9QYXRoO1xuICBpZiAodGhpcy5yZXBvTGlzdC5pbmRleE9mKHJlcG9QYXRoKSAhPSAtMSkgcmV0dXJuO1xuICB0aGlzLnJlcG9MaXN0LnB1c2gocmVwb1BhdGgpO1xufVxuQXBwVmlld01vZGVsLnByb3RvdHlwZS5faGFuZGxlQ3JlZGVudGlhbHNSZXF1ZXN0ZWQgPSBmdW5jdGlvbigpIHtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICB2YXIgZGlhZztcbiAgLy8gT25seSBzaG93IG9uZSBjcmVkZW50aWFscyBkaWFsb2cgaWYgd2UncmUgYXNrZWQgdG8gc2hvdyBhbm90aGVyIG9uZSB3aGlsZSB0aGUgZmlyc3Qgb25lIGlzIG9wZW5cbiAgLy8gVGhpcyBoYXBwZW5zIGZvciBpbnN0YW5jZSB3aGVuIHdlIGZldGNoIG5vZGVzIGFuZCByZW1vdGUgdGFncyBhdCB0aGUgc2FtZSB0aW1lXG4gIGlmICh0aGlzLl9pc1Nob3dpbmdDcmVkZW50aWFsc0RpYWxvZylcbiAgICBkaWFnID0gc2VsZi5kaWFsb2coKTtcbiAgZWxzZSB7XG4gICAgZGlhZyA9IGNvbXBvbmVudHMuY3JlYXRlKCdjcmVkZW50aWFsc2RpYWxvZycpO1xuICAgIHNlbGYuc2hvd0RpYWxvZyhkaWFnKTtcbiAgfVxuICB0aGlzLl9pc1Nob3dpbmdDcmVkZW50aWFsc0RpYWxvZyA9IHRydWU7XG4gIGRpYWcuY2xvc2VkLmFkZChmdW5jdGlvbigpIHtcbiAgICBzZWxmLl9pc1Nob3dpbmdDcmVkZW50aWFsc0RpYWxvZyA9IGZhbHNlO1xuICAgIHByb2dyYW1FdmVudHMuZGlzcGF0Y2goeyBldmVudDogJ3JlcXVlc3QtY3JlZGVudGlhbHMtcmVzcG9uc2UnLCB1c2VybmFtZTogZGlhZy51c2VybmFtZSgpLCBwYXNzd29yZDogZGlhZy5wYXNzd29yZCgpIH0pO1xuICB9KTtcbn1cbkFwcFZpZXdNb2RlbC5wcm90b3R5cGUuc2hvd0RpYWxvZyA9IGZ1bmN0aW9uKGRpYWxvZykge1xuICB2YXIgc2VsZiA9IHRoaXM7XG4gIGRpYWxvZy5jbG9zZWQuYWRkKGZ1bmN0aW9uKCkge1xuICAgIHNlbGYuZGlhbG9nKG51bGwpO1xuICB9KVxuICB0aGlzLmRpYWxvZyhkaWFsb2cpO1xufVxuQXBwVmlld01vZGVsLnByb3RvdHlwZS5lbmFibGVCdWd0cmFja2luZ0FuZFN0YXRpc3RpY3MgPSBmdW5jdGlvbigpIHtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICB0aGlzLnNlcnZlci5nZXQoJy91c2VyY29uZmlnJywgdW5kZWZpbmVkLCBmdW5jdGlvbihlcnIsIHVzZXJDb25maWcpIHtcbiAgICBpZiAoZXJyKSByZXR1cm47XG4gICAgdXNlckNvbmZpZy5idWd0cmFja2luZyA9IHRydWU7XG4gICAgdXNlckNvbmZpZy5zZW5kVXNhZ2VTdGF0aXN0aWNzID0gdHJ1ZTtcbiAgICBzZWxmLnNlcnZlci5wb3N0KCcvdXNlcmNvbmZpZycsIHVzZXJDb25maWcsIGZ1bmN0aW9uKGVycikge1xuICAgICAgaWYgKGVycikgcmV0dXJuO1xuICAgICAgc2VsZi5idWd0cmFja2luZ0VuYWJsZWQodHJ1ZSk7XG4gICAgfSk7XG4gIH0pO1xufVxuQXBwVmlld01vZGVsLnByb3RvdHlwZS5lbmFibGVCdWd0cmFja2luZyA9IGZ1bmN0aW9uKCkge1xuICB2YXIgc2VsZiA9IHRoaXM7XG4gIHRoaXMuc2VydmVyLmdldCgnL3VzZXJjb25maWcnLCB1bmRlZmluZWQsIGZ1bmN0aW9uKGVyciwgdXNlckNvbmZpZykge1xuICAgIGlmIChlcnIpIHJldHVybjtcbiAgICB1c2VyQ29uZmlnLmJ1Z3RyYWNraW5nID0gdHJ1ZTtcbiAgICBzZWxmLnNlcnZlci5wb3N0KCcvdXNlcmNvbmZpZycsIHVzZXJDb25maWcsIGZ1bmN0aW9uKGVycikge1xuICAgICAgaWYgKGVycikgcmV0dXJuO1xuICAgICAgc2VsZi5idWd0cmFja2luZ0VuYWJsZWQodHJ1ZSk7XG4gICAgfSk7XG4gIH0pO1xufVxuQXBwVmlld01vZGVsLnByb3RvdHlwZS5kaXNtaXNzQnVndHJhY2tpbmdOYWdzY3JlZW4gPSBmdW5jdGlvbigpIHtcbiAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ2J1Z3RyYWNraW5nTmFnc2NyZWVuRGlzbWlzc2VkJywgdHJ1ZSk7XG4gIHRoaXMuYnVndHJhY2tpbmdOYWdzY3JlZW5EaXNtaXNzZWQodHJ1ZSk7XG59XG5BcHBWaWV3TW9kZWwucHJvdG90eXBlLmRpc21pc3NHaXRWZXJzaW9uRXJyb3IgPSBmdW5jdGlvbigpIHtcbiAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ2dpdFZlcnNpb25FcnJvckRpc21pc3NlZCcsIHRydWUpO1xuICB0aGlzLmdpdFZlcnNpb25FcnJvckRpc21pc3NlZCh0cnVlKTtcbn1cbkFwcFZpZXdNb2RlbC5wcm90b3R5cGUuZGlzbWlzc05QU1N1cnZleSA9IGZ1bmN0aW9uKCkge1xuICB0aGlzLnNob3dOUFNTdXJ2ZXkoZmFsc2UpO1xuICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnTlBTU3VydmV5TGFzdERpc21pc3NlZCcsIERhdGUubm93KCkpO1xufVxuQXBwVmlld01vZGVsLnByb3RvdHlwZS50ZW1wbGF0ZUNob29zZXIgPSBmdW5jdGlvbihkYXRhKSB7XG4gIGlmICghZGF0YSkgcmV0dXJuICcnO1xuICByZXR1cm4gZGF0YS50ZW1wbGF0ZTtcbn07XG4iXX0=
